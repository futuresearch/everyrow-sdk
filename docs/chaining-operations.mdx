---
title: "Chaining Operations"
description: Combine screen, dedupe, merge, rank, and research operations to build complete data workflows.
---

# Chaining Operations

Operations can be chained together to build complete workflows. Each step refines your data further.

**Example scenario:** A wizard rescuing magical creatures for a sanctuary.

<ChainedOpsTabs>

<StepContent step="screen">

## Screen

**Start with:** Sighting reports from villages—some real, some tall tales.

**Goal:** Keep only confirmed magical creatures (not "my neighbour's cat acts weird").

```python
class CreatureSighting(BaseModel):
    is_magical: bool = Field(description="True if genuinely magical")

screened = await screen(
    session=session,
    task="Keep only confirmed magical creatures, not mundane animals or tall tales",
    input=sightings,
    response_model=CreatureSighting,
)
```

<svg viewBox="0 0 800 200" className="w-full h-auto my-6" style={{ maxWidth: '800px' }}>
  <defs>
    <marker id="arrow" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#6b7280" />
    </marker>
  </defs>

  {/* Before table */}
  <rect x="20" y="20" width="280" height="160" rx="6" fill="#f8fafc" stroke="#e2e8f0" strokeWidth="2" />
  <rect x="20" y="20" width="280" height="28" rx="6" fill="#1e293b" />
  <text x="80" y="39" textAnchor="middle" fill="white" fontSize="11" fontWeight="600">Location</text>
  <text x="200" y="39" textAnchor="middle" fill="white" fontSize="11" fontWeight="600">Report</text>
  <line x1="130" y1="20" x2="130" y2="180" stroke="#e2e8f0" strokeWidth="1" />

  <text x="32" y="65" fill="#334155" fontSize="10">Millbrook</text>
  <text x="140" y="65" fill="#334155" fontSize="10">Glowing deer in forest</text>
  <text x="32" y="88" fill="#334155" fontSize="10">Thornwall</text>
  <text x="140" y="88" fill="#334155" fontSize="10">Cat acts strange at night</text>
  <text x="32" y="111" fill="#334155" fontSize="10">Lakemere</text>
  <text x="140" y="111" fill="#334155" fontSize="10">Serpent spotted in lake</text>
  <text x="32" y="134" fill="#334155" fontSize="10">Oldwick</text>
  <text x="140" y="134" fill="#334155" fontSize="10">Bird talked to farmer</text>
  <text x="32" y="157" fill="#94a3b8" fontSize="10" fontStyle="italic">...46 more reports</text>

  {/* Arrow */}
  <path d="M 320 100 L 380 100" stroke="#6b7280" strokeWidth="2" markerEnd="url(#arrow)" />
  <text x="350" y="85" textAnchor="middle" fill="#6b7280" fontSize="10" fontWeight="500">SCREEN</text>

  {/* After table */}
  <rect x="400" y="20" width="280" height="130" rx="6" fill="#f0fdf4" stroke="#22c55e" strokeWidth="2" />
  <rect x="400" y="20" width="280" height="28" rx="6" fill="#16a34a" />
  <text x="460" y="39" textAnchor="middle" fill="white" fontSize="11" fontWeight="600">Location</text>
  <text x="580" y="39" textAnchor="middle" fill="white" fontSize="11" fontWeight="600">Report</text>
  <line x1="510" y1="20" x2="510" y2="150" stroke="#22c55e" strokeWidth="1" opacity="0.5" />

  <text x="412" y="65" fill="#166534" fontSize="10">Millbrook</text>
  <text x="520" y="65" fill="#166534" fontSize="10">Glowing deer in forest</text>
  <text x="412" y="88" fill="#166534" fontSize="10">Lakemere</text>
  <text x="520" y="88" fill="#166534" fontSize="10">Serpent spotted in lake</text>
  <text x="412" y="111" fill="#94a3b8" fontSize="10" fontStyle="italic">...18 confirmed magical</text>
</svg>

</StepContent>

<StepContent step="dedupe">

## Dedupe

**Problem:** The same creature appears multiple times under different names.

"The Forest Ghost", "Old Silvermane", and "that white unicorn near the river" are all the same unicorn.

```python
deduped = await dedupe(
    session=session,
    input=screened.data,
    equivalence_relation="""
        Two sightings are the same creature if they describe
        the same species in overlapping territories, accounting
        for different local names and descriptions.
    """,
)
```

<svg viewBox="0 0 800 200" className="w-full h-auto my-6" style={{ maxWidth: '800px' }}>
  <defs>
    <marker id="arrow2" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#6b7280" />
    </marker>
  </defs>

  {/* Before table */}
  <rect x="20" y="20" width="280" height="160" rx="6" fill="#f8fafc" stroke="#e2e8f0" strokeWidth="2" />
  <rect x="20" y="20" width="280" height="28" rx="6" fill="#1e293b" />
  <text x="160" y="39" textAnchor="middle" fill="white" fontSize="11" fontWeight="600">Creature Description</text>

  <text x="32" y="65" fill="#334155" fontSize="10">The Forest Ghost (white horse, horn)</text>
  <text x="32" y="88" fill="#334155" fontSize="10">Old Silvermane near river bend</text>
  <text x="32" y="111" fill="#334155" fontSize="10">White unicorn by the waterfall</text>
  <text x="32" y="134" fill="#334155" fontSize="10">Lake serpent, 20 feet long</text>
  <text x="32" y="157" fill="#94a3b8" fontSize="10" fontStyle="italic">...14 more sightings</text>

  {/* Arrow */}
  <path d="M 320 100 L 380 100" stroke="#6b7280" strokeWidth="2" markerEnd="url(#arrow2)" />
  <text x="350" y="85" textAnchor="middle" fill="#6b7280" fontSize="10" fontWeight="500">DEDUPE</text>

  {/* After table */}
  <rect x="400" y="20" width="280" height="130" rx="6" fill="#fef3c7" stroke="#f59e0b" strokeWidth="2" />
  <rect x="400" y="20" width="280" height="28" rx="6" fill="#d97706" />
  <text x="500" y="39" textAnchor="middle" fill="white" fontSize="11" fontWeight="600">Creature</text>
  <text x="630" y="39" textAnchor="middle" fill="white" fontSize="11" fontWeight="600">Sightings</text>
  <line x1="570" y1="20" x2="570" y2="150" stroke="#f59e0b" strokeWidth="1" opacity="0.5" />

  <text x="412" y="65" fill="#92400e" fontSize="10">Silvermane Unicorn</text>
  <text x="590" y="65" fill="#92400e" fontSize="10">3</text>
  <text x="412" y="88" fill="#92400e" fontSize="10">Lake Serpent</text>
  <text x="590" y="88" fill="#92400e" fontSize="10">1</text>
  <text x="412" y="111" fill="#94a3b8" fontSize="10" fontStyle="italic">...8 unique creatures</text>
</svg>

</StepContent>

<StepContent step="merge">

## Merge

**Goal:** Match against the sanctuary registry so you don't chase creatures already rescued.

```python
merged = await merge(
    session=session,
    task="Match sightings to creatures already in the sanctuary",
    left_table=deduped.data,
    right_table=sanctuary_registry,
    merge_on_left="creature_description",
    merge_on_right="creature_name",
)

# Filter to only new creatures
new_creatures = merged.data[merged.data["sanctuary_id"].isna()]
```

<svg viewBox="0 0 800 200" className="w-full h-auto my-6" style={{ maxWidth: '800px' }}>
  <defs>
    <marker id="arrow3" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#6b7280" />
    </marker>
  </defs>

  {/* Before table */}
  <rect x="20" y="20" width="170" height="130" rx="6" fill="#f8fafc" stroke="#e2e8f0" strokeWidth="2" />
  <rect x="20" y="20" width="170" height="28" rx="6" fill="#1e293b" />
  <text x="105" y="39" textAnchor="middle" fill="white" fontSize="11" fontWeight="600">Sightings</text>

  <text x="32" y="65" fill="#334155" fontSize="10">Silvermane Unicorn</text>
  <text x="32" y="88" fill="#334155" fontSize="10">Lake Serpent</text>
  <text x="32" y="111" fill="#334155" fontSize="10">Phoenix of Mt. Ash</text>

  {/* Plus sign */}
  <text x="205" y="90" fill="#6b7280" fontSize="20" fontWeight="bold">+</text>

  {/* Registry table */}
  <rect x="225" y="20" width="140" height="100" rx="6" fill="#e0e7ff" stroke="#6366f1" strokeWidth="2" />
  <rect x="225" y="20" width="140" height="28" rx="6" fill="#4f46e5" />
  <text x="295" y="39" textAnchor="middle" fill="white" fontSize="11" fontWeight="600">Sanctuary</text>

  <text x="237" y="65" fill="#3730a3" fontSize="10">Lake Serpent ✓</text>
  <text x="237" y="88" fill="#3730a3" fontSize="10">Mountain Griffin ✓</text>

  {/* Arrow */}
  <path d="M 385 85 L 445 85" stroke="#6b7280" strokeWidth="2" markerEnd="url(#arrow3)" />
  <text x="415" y="70" textAnchor="middle" fill="#6b7280" fontSize="10" fontWeight="500">MERGE</text>

  {/* After table */}
  <rect x="465" y="20" width="310" height="130" rx="6" fill="#f0fdf4" stroke="#22c55e" strokeWidth="2" />
  <rect x="465" y="20" width="310" height="28" rx="6" fill="#16a34a" />
  <text x="555" y="39" textAnchor="middle" fill="white" fontSize="11" fontWeight="600">Creature</text>
  <text x="700" y="39" textAnchor="middle" fill="white" fontSize="11" fontWeight="600">Status</text>
  <line x1="625" y1="20" x2="625" y2="150" stroke="#22c55e" strokeWidth="1" opacity="0.5" />

  <text x="477" y="65" fill="#166534" fontSize="10">Silvermane Unicorn</text>
  <text x="637" y="65" fill="#166534" fontSize="10">New - needs rescue</text>
  <text x="477" y="88" fill="#94a3b8" fontSize="10">Lake Serpent</text>
  <text x="637" y="88" fill="#94a3b8" fontSize="10">Already rescued</text>
  <text x="477" y="111" fill="#166534" fontSize="10">Phoenix of Mt. Ash</text>
  <text x="637" y="111" fill="#166534" fontSize="10">New - needs rescue</text>
</svg>

</StepContent>

<StepContent step="rank">

## Rank

**Goal:** Prioritize by danger, creatures near poacher routes or harsh weather first.

```python
ranked = await rank(
    session=session,
    task="""
        Score by rescue urgency: creatures near known poacher routes,
        in areas with incoming harsh weather, or showing signs of
        distress should score highest.
    """,
    input=new_creatures,
    field_name="urgency_score",
)

top_priority = ranked.data.nlargest(10, "urgency_score")
```

<svg viewBox="0 0 800 200" className="w-full h-auto my-6" style={{ maxWidth: '800px' }}>
  <defs>
    <marker id="arrow4" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#6b7280" />
    </marker>
  </defs>

  {/* Before table */}
  <rect x="20" y="20" width="260" height="160" rx="6" fill="#f8fafc" stroke="#e2e8f0" strokeWidth="2" />
  <rect x="20" y="20" width="260" height="28" rx="6" fill="#1e293b" />
  <text x="150" y="39" textAnchor="middle" fill="white" fontSize="11" fontWeight="600">New Creatures</text>

  <text x="32" y="65" fill="#334155" fontSize="10">Silvermane Unicorn</text>
  <text x="32" y="88" fill="#334155" fontSize="10">Phoenix of Mt. Ash</text>
  <text x="32" y="111" fill="#334155" fontSize="10">Moonpetal Fairy</text>
  <text x="32" y="134" fill="#334155" fontSize="10">Bramblewood Bear</text>
  <text x="32" y="157" fill="#94a3b8" fontSize="10" fontStyle="italic">...3 more creatures</text>

  {/* Arrow */}
  <path d="M 300 100 L 360 100" stroke="#6b7280" strokeWidth="2" markerEnd="url(#arrow4)" />
  <text x="330" y="85" textAnchor="middle" fill="#6b7280" fontSize="10" fontWeight="500">RANK</text>

  {/* After table */}
  <rect x="380" y="20" width="320" height="160" rx="6" fill="#fef2f2" stroke="#ef4444" strokeWidth="2" />
  <rect x="380" y="20" width="320" height="28" rx="6" fill="#dc2626" />
  <text x="480" y="39" textAnchor="middle" fill="white" fontSize="11" fontWeight="600">Creature</text>
  <text x="620" y="39" textAnchor="middle" fill="white" fontSize="11" fontWeight="600">Urgency</text>
  <line x1="560" y1="20" x2="560" y2="180" stroke="#ef4444" strokeWidth="1" opacity="0.5" />

  <text x="392" y="65" fill="#991b1b" fontSize="10">Phoenix of Mt. Ash</text>
  <text x="572" y="65" fill="#991b1b" fontSize="10" fontWeight="600">0.94 ●●●●●</text>
  <text x="392" y="88" fill="#991b1b" fontSize="10">Silvermane Unicorn</text>
  <text x="572" y="88" fill="#991b1b" fontSize="10" fontWeight="600">0.87 ●●●●○</text>
  <text x="392" y="111" fill="#b91c1c" fontSize="10">Moonpetal Fairy</text>
  <text x="572" y="111" fill="#b91c1c" fontSize="10">0.62 ●●●○○</text>
  <text x="392" y="134" fill="#b91c1c" fontSize="10">Bramblewood Bear</text>
  <text x="572" y="134" fill="#b91c1c" fontSize="10">0.41 ●●○○○</text>
  <text x="392" y="157" fill="#94a3b8" fontSize="10" fontStyle="italic">...sorted by urgency</text>
</svg>

</StepContent>

<StepContent step="research">

## Research

**Goal:** For the most urgent, find where they were last seen and what they need to survive.

```python
researched = await agent_map(
    session=session,
    task="""
        Find detailed information about this creature:
        - Last confirmed location
        - Habitat requirements
        - Dietary needs
        - Any known threats in the area
    """,
    input=top_priority,
)
```

<svg viewBox="0 0 800 200" className="w-full h-auto my-6" style={{ maxWidth: '800px' }}>
  <defs>
    <marker id="arrow5" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#6b7280" />
    </marker>
  </defs>

  {/* Before table */}
  <rect x="20" y="20" width="180" height="130" rx="6" fill="#f8fafc" stroke="#e2e8f0" strokeWidth="2" />
  <rect x="20" y="20" width="180" height="28" rx="6" fill="#1e293b" />
  <text x="110" y="39" textAnchor="middle" fill="white" fontSize="11" fontWeight="600">Top Priority</text>

  <text x="32" y="65" fill="#334155" fontSize="10">Phoenix of Mt. Ash</text>
  <text x="32" y="88" fill="#334155" fontSize="10">Silvermane Unicorn</text>
  <text x="32" y="111" fill="#94a3b8" fontSize="10" fontStyle="italic">...top 10</text>

  {/* Arrow */}
  <path d="M 220 85 L 280 85" stroke="#6b7280" strokeWidth="2" markerEnd="url(#arrow5)" />
  <text x="250" y="70" textAnchor="middle" fill="#6b7280" fontSize="10" fontWeight="500">RESEARCH</text>

  {/* After table */}
  <rect x="300" y="10" width="480" height="180" rx="6" fill="#eff6ff" stroke="#3b82f6" strokeWidth="2" />
  <rect x="300" y="10" width="480" height="28" rx="6" fill="#2563eb" />
  <text x="370" y="29" textAnchor="middle" fill="white" fontSize="11" fontWeight="600">Creature</text>
  <text x="510" y="29" textAnchor="middle" fill="white" fontSize="11" fontWeight="600">Location</text>
  <text x="680" y="29" textAnchor="middle" fill="white" fontSize="11" fontWeight="600">Needs</text>
  <line x1="430" y1="10" x2="430" y2="190" stroke="#3b82f6" strokeWidth="1" opacity="0.3" />
  <line x1="590" y1="10" x2="590" y2="190" stroke="#3b82f6" strokeWidth="1" opacity="0.3" />

  <text x="312" y="58" fill="#1e40af" fontSize="10">Phoenix</text>
  <text x="442" y="58" fill="#1e40af" fontSize="10">Mt. Ash summit</text>
  <text x="602" y="58" fill="#1e40af" fontSize="10">Fire-resistant cage</text>
  <text x="312" y="75" fill="#1e40af" fontSize="9" fontStyle="italic">of Mt. Ash</text>
  <text x="442" y="75" fill="#1e40af" fontSize="9" fontStyle="italic">near lava vents</text>
  <text x="602" y="75" fill="#1e40af" fontSize="9" fontStyle="italic">volcanic ash diet</text>

  <text x="312" y="108" fill="#1e40af" fontSize="10">Silvermane</text>
  <text x="442" y="108" fill="#1e40af" fontSize="10">Mirrim Forest</text>
  <text x="602" y="108" fill="#1e40af" fontSize="10">Moonlit clearing</text>
  <text x="312" y="125" fill="#1e40af" fontSize="9" fontStyle="italic">Unicorn</text>
  <text x="442" y="125" fill="#1e40af" fontSize="9" fontStyle="italic">northern glade</text>
  <text x="602" y="125" fill="#1e40af" fontSize="9" fontStyle="italic">silver apples</text>

  <text x="312" y="165" fill="#94a3b8" fontSize="10" fontStyle="italic">...enriched with rescue details</text>
</svg>

Now you have everything needed to dispatch rescue teams.

</StepContent>

</ChainedOpsTabs>

---

## Common Workflows

Here are practical examples of chaining 2-3 operations for everyday analyst tasks.

### Consolidate messy lead lists

**Problem:** You have leads from a trade show, a purchased list, and your CRM export. Same companies appear under different names.

**Workflow:** Concatenate → Dedupe → Rank

```python
# Combine sources
all_leads = pd.concat([trade_show, purchased_list, crm_export])

# Dedupe across sources
deduped = await dedupe(
    input=all_leads,
    equivalence_relation="Same company, accounting for Inc/LLC variations, abbreviations, and parent/subsidiary relationships",
)

# Prioritize for outreach
ranked = await rank(
    task="Score by likelihood to need our data integration product",
    input=deduped.data,
    field_name="fit_score",
)
```

### Vet vendors before RFP

**Problem:** You have 200 potential vendors. Need to shortlist ones that meet basic requirements, then rank by fit.

**Workflow:** Screen → Rank

```python
# Filter to qualified vendors
screened = await screen(
    task="Must have SOC2 certification, 50+ employees, and enterprise references",
    input=vendor_list,
    response_model=VendorQualification,
)

# Rank survivors by fit
ranked = await rank(
    task="Score by alignment with our technical requirements and budget constraints",
    input=screened.data,
    field_name="fit_score",
)
```

### Match products to approved suppliers

**Problem:** Procurement has a list of software products in use. Need to check each against the approved vendor list—but product names don't match company names (Photoshop vs Adobe).

**Workflow:** Research → Merge

```python
# First, enrich products with parent company info
enriched = await agent_map(
    task="Find the parent company that makes this software product",
    input=software_products,
)

# Now merge with approved vendors
matched = await merge(
    task="Match products to approved vendors by parent company",
    left_table=enriched.data,
    right_table=approved_vendors,
    merge_on_left="parent_company",
    merge_on_right="vendor_name",
)

# Flag unapproved software for review
unapproved = matched.data[matched.data["vendor_id"].isna()]
```

### Enrich accounts before territory planning

**Problem:** CRM has company names but missing firmographic data. Need employee count and industry before assigning to sales territories.

**Workflow:** Research → Rank

```python
# Enrich with firmographics
enriched = await agent_map(
    task="Find employee count, industry, and headquarters location",
    input=accounts,
)

# Score for territory assignment
ranked = await rank(
    task="Score by revenue potential based on company size and industry fit",
    input=enriched.data,
    field_name="territory_priority",
)
```

### Dedupe research from multiple sources

**Problem:** You scraped company data from LinkedIn, Crunchbase, and news articles. Same companies appear with different descriptions.

**Workflow:** Concatenate → Dedupe

```python
# Combine all research
all_research = pd.concat([linkedin_data, crunchbase_data, news_mentions])

# Consolidate into canonical records
deduped = await dedupe(
    input=all_research,
    equivalence_relation="""
        Same company if names match accounting for legal suffixes,
        or if they share the same website domain or headquarters address
    """,
)
# Result includes best available data from all sources
```
